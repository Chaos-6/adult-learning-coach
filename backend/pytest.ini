[pytest]
# Use asyncio mode for all async tests
asyncio_mode = auto

# CRITICAL: Use a single event loop for the entire test session.
# asyncpg binds connections to the event loop that created them.
# The app creates its engine at import time. If each test gets a new
# event loop (the default), the app's engine connections break.
# Sharing one loop avoids this entirely.
asyncio_default_fixture_loop_scope = session
asyncio_default_test_loop_scope = session

# Test discovery paths
testpaths = tests

# Show verbose output with short traceback
addopts = -v --tb=short

# Filter expected deprecation warnings from dependencies
filterwarnings =
    ignore::DeprecationWarning:passlib.*
